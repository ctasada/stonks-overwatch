{% extends 'base.html' %}
{% load custom_tags %}

{% block content %}
<!-- ChartJS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-autocolors"></script>
  
<h4 class="mb-3">Dividends</h4>
<div class="container-fluid">
    <div class="row">
        <div id="container" style="width: 100%;">
            <canvas id="dividends-growth"></canvas>
        </div>
    </div>
    <div class="row"><h5 class="mb-4">Calendar</h4></div>
    <div class="row" style="background-color:#dbf5ff">
        {% for key, value in dividendsCalendar.items %}
            <div class="col-sm-4 border">
                <div class="row-sm mt-1 fs-5">
                    {{ key }}
                </div>
                <div class="row m-2">
                    <div class="col text-left">
                        {{ value.payouts }} payouts
                    </div>
                    <div class="col-md-auto text-right border rounded-pill" style="background-color: #7386D5; color: white">
                        {{ value.formatedTotal }}
                    </div>
                </div>
                {% for day, dividends in value.days.items %}
                    {% for key, dividend in dividends.items %}
                        {% if dividend.change != 0 %}
                            <div class="row m-2 border rounded-pill" style="background-color: #A6B9FF">
                                <div class="col-sm-1 text-left">
                                    {{ day }}
                                </div>
                                <div class="col-sm-8 text-truncate">
                                    {{ dividend.stockName }}
                                </div>
                                <div class="col-sm-3 text-right">
                                    {{ dividend.formatedChange }}
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </div>

            {% if forloop.counter|divisibleby:3 %}
                <!-- Force next columns to break to new line at md breakpoint and up -->
                <div class="w-100 d-none d-md-block"></div>
            {% endif %}
        {% endfor %}
    </div>
</div>

<script>
    // Customize colors with https://www.npmjs.com/package/@seahsky/chartjs-plugin-autocolors#customize
    const autocolors = window['chartjs-plugin-autocolors'];

    const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    const data = {
        labels: months,
        datasets: [
            {% for key, value in dividendsGrowth.items %}
            {
                label: "{{ key }}",
                data: {{ value }},
                borderWidth: 1
            },
            {% endfor %}
        ]
    };
    const config = {
        type: 'bar',
        data: data,
        plugins: [
            autocolors
        ],
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: false,
                }
            }
        },
    };
    let chart = new Chart(document.getElementById("dividends-growth").getContext("2d"), config);
</script>
{% endblock %}